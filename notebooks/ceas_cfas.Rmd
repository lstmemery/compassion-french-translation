---
title: "CEAS CFAs"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(feather)
library(psych)
library(lavaan)
library(blavaan)
library(bayesplot)
library(loo)
library(semPlot)
future::plan("multisession")
source("funcs.R")
```

### CEAS-SC

```{r}
ceas_sc <- read_feather("../results/tidy_ceas_sc.feather")
```

```{r}
ceas_sc_wide <- ceas_sc %>% 
  pivot_wider(values_from = response, id_cols = ResponseId, names_from = item) %>% 
  filter_all(all_vars(!is.na(.)))

ceas_sc_wide
```

```{r}
ceas_sc_cor <- cor(ceas_sc_wide %>% select(-ResponseId), method="spearman")
ceas_sc_cor
```

```{r}
eigen(ceas_sc_cor)$values
```

```{r}
ceas_sc_one_model <- "CEAS_SC =~ CEAS_SC1_1 + CEAS_SC1_2 + CEAS_SC1_4 + CEAS_SC1_5 + CEAS_SC1_6 + CEAS_SC1_8 + CEAS_SC2_1 + CEAS_SC2_2 + CEAS_SC2_4 + CEAS_SC2_5"
ceas_sc_one_fit <- lav_fit_measures(ceas_sc_one_model, ceas_sc_wide, "One Factor", "CEAS-SC")
ceas_sc_one_fit
```

```{r}
ceas_sc_two_model <- "
CEAS_SC_Engagement =~ CEAS_SC1_1 + CEAS_SC1_2 + CEAS_SC1_4 + CEAS_SC1_5 + CEAS_SC1_6 + CEAS_SC1_8
CEAS_SC_Action =~ CEAS_SC2_1 + CEAS_SC2_2 + CEAS_SC2_4 + CEAS_SC2_5
"

ceas_sc_two_fit <- lav_fit_measures(ceas_sc_two_model, ceas_sc_wide, "Two Factor", "CEAS-SC")
ceas_sc_two_fit
```

```{r}
ceas_sc_level_one_model <- "
CEAS_SC_Engagement =~ CEAS_SC1_1 + CEAS_SC1_2 + CEAS_SC1_4 + CEAS_SC1_5 + CEAS_SC1_6 + CEAS_SC1_8
CEAS_SC_Action =~ CEAS_SC2_1 + CEAS_SC2_2 + CEAS_SC2_4 + CEAS_SC2_5
CEAS_SC =~ CEAS_SC_Engagement + CEAS_SC_Action
"

ceas_sc_level_one_fit <- lav_fit_measures(ceas_sc_level_one_model, ceas_sc_wide, "Second Order", "CEAS-SC")
ceas_sc_level_one_fit
```

```{r}
ceas_sc_three_model <- "
CEAS_SC_Engagement_1 =~ CEAS_SC1_2 + CEAS_SC1_4
CEAS_SC_Engagement_2 =~ CEAS_SC1_1 + CEAS_SC1_5 + CEAS_SC1_6 + CEAS_SC1_8
CEAS_SC_Action =~ CEAS_SC2_1 + CEAS_SC2_2 + CEAS_SC2_4 + CEAS_SC2_5
"

ceas_sc_three_fit <- lav_fit_measures(ceas_sc_three_model, ceas_sc_wide, "Three Factor", "CEAS-SC")
ceas_sc_three_fit
```

```{r}
ceas_sc_level_two_model <- "
CEAS_SC_Engagement_1 =~ CEAS_SC1_2 + CEAS_SC1_4
CEAS_SC_Engagement_2 =~ CEAS_SC1_1 + CEAS_SC1_5 + CEAS_SC1_6 + CEAS_SC1_8
CEAS_SC_Engagement =~ 1*CEAS_SC_Engagement_1 + 1*CEAS_SC_Engagement_2
CEAS_SC_Action =~ CEAS_SC2_1 + CEAS_SC2_2 + CEAS_SC2_4 + CEAS_SC2_5
CEAS_SC =~ 1*CEAS_SC_Engagement + 1*CEAS_SC_Action
"

ceas_sc_level_two_fit <- lav_fit_measures(ceas_sc_level_two_model, ceas_sc_wide, "Third Order (Equal Loadings)", "CEAS-SC")
ceas_sc_level_two_fit
```

### CEAS-FROM

```{r}
ceas_from <- read_feather("../results/tidy_ceas_from.feather")
```

```{r}
ceas_from_wide <- ceas_from %>% 
  pivot_wider(values_from = response, id_cols = ResponseId, names_from = item) %>% 
  filter_all(all_vars(!is.na(.)))
```

```{r}
ceas_from_cor <- cor(ceas_from_wide %>% select(-ResponseId), method="spearman")
ceas_from_cor
```

```{r}
eigen(ceas_from_cor)$values
```

```{r}
ceas_from_one_model <- "CEAS_FROM =~ CEAS_FROM1_1 + CEAS_FROM1_2 + CEAS_FROM1_4 + CEAS_FROM1_5 + CEAS_FROM1_6 + CEAS_FROM1_8 + CEAS_FROM2_1 + CEAS_FROM2_2 + CEAS_FROM2_4 + CEAS_FROM2_5
"

ceas_from_one_fit <- lav_fit_measures(ceas_from_one_model, ceas_from_wide, "One Factor", "CEAS-FROM")
ceas_from_one_fit
```

```{r}
ceas_from_two_model <- "
CEAS_FROM_Engagement =~ CEAS_FROM1_1 + CEAS_FROM1_2 + CEAS_FROM1_4 + CEAS_FROM1_5 + CEAS_FROM1_6 + CEAS_FROM1_8
CEAS_FROM_Action =~ CEAS_FROM2_1 + CEAS_FROM2_2 + CEAS_FROM2_4 + CEAS_FROM2_5
"

ceas_from_two_fit <- lav_fit_measures(ceas_from_two_model, ceas_from_wide, "Two Factor", "CEAS-FROM")
ceas_from_two_fit
```

```{r}
ceas_from_level_one_model <- "
CEAS_FROM_Engagement =~ CEAS_FROM1_1 + CEAS_FROM1_2 + CEAS_FROM1_4 + CEAS_FROM1_5 + CEAS_FROM1_6 + CEAS_FROM1_8
CEAS_FROM_Action =~ CEAS_FROM2_1 + CEAS_FROM2_2 + CEAS_FROM2_4 + CEAS_FROM2_5
CEAS_FROM =~ CEAS_FROM_Engagement + CEAS_FROM_Action
"

ceas_from_level_one_fit <- lav_fit_measures(ceas_from_level_one_model, ceas_from_wide, "Second Order", "CEAS-FROM")
ceas_from_level_one_fit
```

### CEAS-TO

```{r}
ceas_to <- read_feather("../results/tidy_ceas_to.feather")
```

```{r}
ceas_to_wide <- ceas_to %>% 
  pivot_wider(values_from = response, id_cols = ResponseId, names_from = item) %>% 
  filter_all(all_vars(!is.na(.)))
```

```{r}
ceas_to_cor <- cor(ceas_to_wide %>% select(-ResponseId), method="spearman")
ceas_to_cor
```

```{r}
eigen(ceas_to_cor)$values
```

```{r}
ceas_to_one_model <- "CEAS_TO =~ CEAS_TO1_1 + CEAS_TO1_2 + CEAS_TO1_4 + CEAS_TO1_5 + CEAS_TO1_6 + CEAS_TO1_8 + CEAS_TO2_1 + CEAS_TO2_2 + CEAS_TO2_4 + CEAS_TO2_5
"

ceas_to_one_fit <- lav_fit_measures(ceas_to_one_model, ceas_to_wide, "One Factor", "CEAS-TO")
ceas_to_one_fit
```

```{r}
ceas_to_two_factor_model <- "
CEAS_TO_Engagement =~ CEAS_TO1_1 + CEAS_TO1_2 + CEAS_TO1_4 + CEAS_TO1_5 + CEAS_TO1_6 + CEAS_TO1_8
CEAS_TO_Action =~ CEAS_TO2_1 + CEAS_TO2_2 + CEAS_TO2_4 + CEAS_TO2_5
"

ceas_to_two_fit <- lav_fit_measures(ceas_to_two_factor_model, ceas_to_wide, "Two Factor", "CEAS-TO")
ceas_to_two_fit
```

```{r}
ceas_to_level_one_model <- "
CEAS_TO_Engagement =~ CEAS_TO1_1 + CEAS_TO1_2 + CEAS_TO1_4 + CEAS_TO1_5 + CEAS_TO1_6 + CEAS_TO1_8
CEAS_TO_Action =~ CEAS_TO2_1 + CEAS_TO2_2 + CEAS_TO2_4 + CEAS_TO2_5
CEAS_TO =~ 1*CEAS_TO_Engagement + 1*CEAS_TO_Action
"

ceas_to_level_one_fit <- lav_fit_measures(ceas_to_level_one_model, ceas_to_wide, "Second Order (Equal Loadings)", "CEAS-TO")
ceas_to_level_one_fit
```

```{r}
bind_rows(
  ceas_sc_one_fit,
  ceas_sc_two_fit,
  ceas_sc_level_one_fit,
  ceas_sc_three_fit,
  ceas_sc_level_two_fit,
  ceas_from_one_fit,
  ceas_from_two_fit,
  ceas_from_level_one_fit,
  ceas_to_one_fit,
  ceas_to_two_fit,
  ceas_to_level_one_fit
) %>% 
  format_huxtable("../results/ceas-cfas.docx")
```

```{r}
sessionInfo()
```
